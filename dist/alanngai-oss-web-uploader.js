/*! For license information please see alanngai-oss-web-uploader.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["alanngai-oss-web-uploader"]=e():t["alanngai-oss-web-uploader"]=e()}(this,(()=>(()=>{var t={61:(t,e,n)=>{var r=n(698).default;function o(){"use strict";t.exports=o=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},n=Object.prototype,i=n.hasOwnProperty,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",s=u.asyncIterator||"@@asyncIterator",c=u.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof p?e:p,i=Object.create(o.prototype),u=new Q(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var u=n.delegate;if(u){var a=k(u,n);if(a){if(a===d)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=h(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,u),i}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d={};function p(){}function g(){}function y(){}var v={};f(v,a,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(L([])));w&&w!==n&&i.call(w,a)&&(v=w);var b=y.prototype=p.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function n(o,u,a,s){var c=h(t[o],t,u);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"==r(l)&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var o;this._invoke=function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}}function k(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=h(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Q(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function L(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:B}}function B(){return{value:void 0,done:!0}}return g.prototype=y,f(b,"constructor",y),f(y,"constructor",g),g.displayName=f(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,f(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},x(_.prototype),f(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var u=new _(l(t,n,r,o),i);return e.isGeneratorFunction(n)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},x(b),f(b,c,"Generator"),f(b,a,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,Q.prototype={constructor:Q,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return u.type="throw",u.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],u=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=i.call(o,"catchLoc"),s=i.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var u=o?o.completion:{};return u.type=t,u.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(u)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:L(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},698:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},687:(t,e,n)=>{var r=n(61)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function t(t,e,n,r,o,i,u){try{var a=t[i](u),s=a.value}catch(t){return void n(t)}a.done?e(s):Promise.resolve(s).then(r,o)}function e(e){return function(){var n=this,r=arguments;return new Promise((function(o,i){var u=e.apply(n,r);function a(e){t(u,o,i,a,s,"next",e)}function s(e){t(u,o,i,a,s,"throw",e)}a(void 0)}))}}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.r(r),n.d(r,{default:()=>c});var i=n(687),u=n.n(i),a=a||function(t,e){var n={},r=n.lib={},o=function(){},i=r.Base={extend:function(t){o.prototype=this;var e=new o;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},u=r.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||s).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes;if(t=t.sigBytes,this.clamp(),r%4)for(var o=0;o<t;o++)e[r+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(r+o)%4*8;else if(65535<n.length)for(o=0;o<t;o+=4)e[r+o>>>2]=n[o>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],r=0;r<e;r+=4)n.push(4294967296*t.random()|0);return new u.init(n,e)}}),a=n.enc={},s=a.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++){var o=e[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new u.init(n,e/2)}},c=a.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++)n.push(String.fromCharCode(e[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new u.init(n,e)}},f=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=f.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=o/(4*i);if(e=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*i,o=t.min(4*e,o),e){for(var s=0;s<e;s+=i)this._doProcessBlock(r,s);s=r.splice(0,e),n.sigBytes-=o}return new u.init(s,o)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});r.Hasher=l.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);!function(t){function e(t,e,n,r,o,i,u){return((t=t+(e&n|~e&r)+o+u)<<i|t>>>32-i)+e}function n(t,e,n,r,o,i,u){return((t=t+(e&r|n&~r)+o+u)<<i|t>>>32-i)+e}function r(t,e,n,r,o,i,u){return((t=t+(e^n^r)+o+u)<<i|t>>>32-i)+e}function o(t,e,n,r,o,i,u){return((t=t+(n^(e|~r))+o+u)<<i|t>>>32-i)+e}for(var i=a,u=(c=i.lib).WordArray,s=c.Hasher,c=i.algo,f=[],l=0;64>l;l++)f[l]=4294967296*t.abs(t.sin(l+1))|0;c=c.MD5=s.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,i){for(var u=0;16>u;u++){var a=t[s=i+u];t[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}u=this._hash.words;var s=t[i+0],c=(a=t[i+1],t[i+2]),l=t[i+3],h=t[i+4],d=t[i+5],p=t[i+6],g=t[i+7],y=t[i+8],v=t[i+9],m=t[i+10],w=t[i+11],b=t[i+12],x=t[i+13],_=t[i+14],k=t[i+15],S=e(S=u[0],L=u[1],Q=u[2],O=u[3],s,7,f[0]),O=e(O,S,L,Q,a,12,f[1]),Q=e(Q,O,S,L,c,17,f[2]),L=e(L,Q,O,S,l,22,f[3]);S=e(S,L,Q,O,h,7,f[4]),O=e(O,S,L,Q,d,12,f[5]),Q=e(Q,O,S,L,p,17,f[6]),L=e(L,Q,O,S,g,22,f[7]),S=e(S,L,Q,O,y,7,f[8]),O=e(O,S,L,Q,v,12,f[9]),Q=e(Q,O,S,L,m,17,f[10]),L=e(L,Q,O,S,w,22,f[11]),S=e(S,L,Q,O,b,7,f[12]),O=e(O,S,L,Q,x,12,f[13]),Q=e(Q,O,S,L,_,17,f[14]),S=n(S,L=e(L,Q,O,S,k,22,f[15]),Q,O,a,5,f[16]),O=n(O,S,L,Q,p,9,f[17]),Q=n(Q,O,S,L,w,14,f[18]),L=n(L,Q,O,S,s,20,f[19]),S=n(S,L,Q,O,d,5,f[20]),O=n(O,S,L,Q,m,9,f[21]),Q=n(Q,O,S,L,k,14,f[22]),L=n(L,Q,O,S,h,20,f[23]),S=n(S,L,Q,O,v,5,f[24]),O=n(O,S,L,Q,_,9,f[25]),Q=n(Q,O,S,L,l,14,f[26]),L=n(L,Q,O,S,y,20,f[27]),S=n(S,L,Q,O,x,5,f[28]),O=n(O,S,L,Q,c,9,f[29]),Q=n(Q,O,S,L,g,14,f[30]),S=r(S,L=n(L,Q,O,S,b,20,f[31]),Q,O,d,4,f[32]),O=r(O,S,L,Q,y,11,f[33]),Q=r(Q,O,S,L,w,16,f[34]),L=r(L,Q,O,S,_,23,f[35]),S=r(S,L,Q,O,a,4,f[36]),O=r(O,S,L,Q,h,11,f[37]),Q=r(Q,O,S,L,g,16,f[38]),L=r(L,Q,O,S,m,23,f[39]),S=r(S,L,Q,O,x,4,f[40]),O=r(O,S,L,Q,s,11,f[41]),Q=r(Q,O,S,L,l,16,f[42]),L=r(L,Q,O,S,p,23,f[43]),S=r(S,L,Q,O,v,4,f[44]),O=r(O,S,L,Q,b,11,f[45]),Q=r(Q,O,S,L,k,16,f[46]),S=o(S,L=r(L,Q,O,S,c,23,f[47]),Q,O,s,6,f[48]),O=o(O,S,L,Q,g,10,f[49]),Q=o(Q,O,S,L,_,15,f[50]),L=o(L,Q,O,S,d,21,f[51]),S=o(S,L,Q,O,b,6,f[52]),O=o(O,S,L,Q,l,10,f[53]),Q=o(Q,O,S,L,m,15,f[54]),L=o(L,Q,O,S,a,21,f[55]),S=o(S,L,Q,O,y,6,f[56]),O=o(O,S,L,Q,k,10,f[57]),Q=o(Q,O,S,L,p,15,f[58]),L=o(L,Q,O,S,x,21,f[59]),S=o(S,L,Q,O,h,6,f[60]),O=o(O,S,L,Q,w,10,f[61]),Q=o(Q,O,S,L,c,15,f[62]),L=o(L,Q,O,S,v,21,f[63]),u[0]=u[0]+S|0,u[1]=u[1]+L|0,u[2]=u[2]+Q|0,u[3]=u[3]+O|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;n[o>>>5]|=128<<24-o%32;var i=t.floor(r/4294967296);for(n[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(o+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(n.length+1),this._process(),n=(e=this._hash).words,r=0;4>r;r++)o=n[r],n[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return e},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}}),i.MD5=s._createHelper(c),i.HmacMD5=s._createHmacHelper(c)}(Math);const s=a,c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.countTask=0,this.concurrencyCount=1,this.waitingQueue=[],this.uploadingQueue=[],this.errorQueue=[],this.uploadedQueue=[],this.choosing=!1,this.uploading=!1,this.isCheckingQueue=!1,this.taskId=0,this.loadedBuffer=0,this.bufferSpeed=0,this.checkQueueList=null,this.debug=!1,this.signatureApi=e,this.signatureInfo=null,this.onComputedId=null,this.onComputedMd5=null,this.onSuccess=null,this.onError=null,this.onAllFinish=null,this.onAllSuccess=null,this.onProgress=null}var n,r,i;return n=t,r=[{key:"uploadFiles",value:function(n){var r=n.files,o=n.onComputedId,i=n.onComputedMd5,a=n.onProgress,s=n.onSuccess,c=n.onAllSuccess,f=n.onError;r=Array.from(r);var l=this;l.countTask+=r.length,l.uploading=!0,l.loadedBuffer=0,l.bufferSpeed=0,l.onComputedId=o,l.onComputedMd5=i,l.onSuccess=s,l.onError=f,l.onAllSuccess=c,l.onProgress=a;var h=0;function d(){h<r.length?function(){p.apply(this,arguments)}():l.checkQueueList()}function p(){return(p=e(u().mark((function e(){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r[h],o={id:l.taskId,url:window.URL.createObjectURL(n),suffix:t.getFileSuffix(n.name),status:"wait",file:n},l.waitingQueue.push(o),g(o),l.taskId++,e.prev=5,e.next=8,t.computeMd5(n);case 8:o.md5=e.sent,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),t.removeOutOf(l.waitingQueue,o),v(o);case 15:h++,d();case 17:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}function g(t){y(t,"inited"),"function"==typeof l.onComputedId&&l.onComputedId(Object.assign({},t))}function y(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.status=e,t.progress=n,"function"==typeof l.onProgress&&l.onProgress(Object.assign({},t))}function v(t){y(t,"fail"),l.errorQueue.push(t),"function"==typeof l.onError&&l.onError(Object.assign({},t))}l.checkQueueList=function(){if(0!==l.waitingQueue.length&&l.uploadingQueue.length<l.concurrencyCount){l.isCheckingQueue=!0;var e=l.waitingQueue.shift();l.uploadingQueue.push(e),new Promise((function(t,e){l.signatureInfo?t():l.signatureApi().then((function(e){l.signatureInfo=e,t()})).catch((function(){e()}))})).then((function(){return function(e){var n=new XMLHttpRequest;function r(){t.removeOutOf(l.uploadingQueue,e),v(e),l.checkQueueList()}n.open("POST",l.debug?l.signatureInfo.host+"123":l.signatureInfo.host,!0),n.onload=function(n){if(4==n.target.readyState&&200==n.target.status){var o=JSON.parse(n.target.responseText).data;"Ok"===o.Status?(t.removeOutOf(l.uploadingQueue,e),e.uploadedUrl=o.url,l.uploadedQueue.push(e),function(t){if(y(t,"success"),"function"==typeof l.onSuccess){var e=l.waitingQueue.length+l.uploadingQueue.length+l.errorQueue.length;l.onSuccess(Object.assign({},t),e)}}(e),l.checkQueueList()):r()}else r()},n.upload.onprogress=function(t){var n=t.loaded/t.total;l.bufferSpeed+=t.loaded-l.loadedBuffer,l.loadedBuffer=t.loaded,y(e,"loading",n)},n.onerror=function(){r()};var o=new FormData;o.append("name","".concat(e.md5,".").concat(e.suffix)),o.append("key","".concat(l.signatureInfo.dir).concat(e.md5,".").concat(e.suffix)),o.append("policy",l.signatureInfo.policy),o.append("OSSAccessKeyId",l.signatureInfo.accessid),o.append("success_action_status","200"),o.append("signature",l.signatureInfo.signature),o.append("callback",l.signatureInfo.callback),o.append("file",e.file),n.send(o),e.xhr=n}(e)})).catch((function(){t.removeOutOf(l.uploadingQueue,e),v(e),l.checkQueueList()}))}else 0===l.waitingQueue.length&&0===l.uploadingQueue.length&&(l.isCheckingQueue=!1,l.uploading=!1,l.bufferSpeed=0,l.loadedBuffer=0,"function"==typeof l.onAllFinish&&l.onAllFinish(),0===l.errorQueue.length&&"function"==typeof l.onAllSuccess&&l.onAllSuccess())},d()}},{key:"toggleDebug",value:function(){this.debug=!this.debug}},{key:"retryErrorQueue",value:function(){for(;this.errorQueue.length;){var t=this.errorQueue.shift(),e={id:t.id,url:t.url,suffix:t.suffix,file:t.file,md5:t.md5,status:"md5"};this.waitingQueue.push(e)}this.isCheckingQueue||this.checkQueueList&&this.checkQueueList()}},{key:"retryErrorTaskById",value:function(t){var e=this.errorQueue.findIndex((function(e){return e.id===Number(t)}));if(e>-1){var n=this.errorQueue.splice(e,1)[0],r={id:n.id,url:n.url,suffix:n.suffix,file:n.file,md5:n.md5,status:"md5"};this.waitingQueue.push(r),this.isCheckingQueue||this.checkQueueList&&this.checkQueueList()}}},{key:"delTaskById",value:function(e){var n={id:Number(e)};t.removeOutOf(this.waitingQueue,n),t.removeOutOf(this.uploadingQueue,n),t.removeOutOf(this.uploadedQueue,n),t.removeOutOf(this.errorQueue,n),this.countTask-=1}}],i=[{key:"removeOutOf",value:function(t,e){for(var n=0;n<t.length;n++)t[n].id==e.id&&t.splice(n,1)}},{key:"computeMd5",value:function(e){return new Promise((function(n,r){var o=new FileReader;o.onload=function(){n(t.getFileMd5(o.result,e))},o.onerror=function(){r()},o.readAsDataURL(e)}))}},{key:"getFileMd5",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=s.MD5(t+e.lastModified+n).toString();return[r.substring(0,8),r.substring(8,12),r.substring(12,16),r.substring(16,20),r.substring(20,32)].join("-")}},{key:"chunckFileToBlob",value:function(t){t.slice=t.slice||t.webkitSlice;var e=t.slice(0,100),n=t.slice(t.size/2-50,t.size/2+50),r=t.slice(t.size-100,t.size);return new Blob([e,n,r])}},{key:"getFileSuffix",value:function(t){var e=t.lastIndexOf("."),n="";return-1!=e&&(n=t.substring(e+1)),n}},{key:"parseBufferSpeed",value:function(t){return t>1048576?(t/1048576).toFixed(1)+"MB/s":Math.round(t/1024)+"KB/s"}}],r&&o(n.prototype,r),i&&o(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}()})(),r})()));